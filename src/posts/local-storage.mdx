---
title: 'Local Storage ç­†è¨˜'
date: '2020-01-02'
tag: 'javascript'
---

LocalStorage æ˜¯ç€è¦½å™¨æœ€ç°¡å–®çš„è³‡æ–™å„²å­˜æ–¹æ³•ï¼Œå„²å­˜çš„è³‡æ–™ä¸æœƒéš¨è‘—é é¢é‡æ•´æˆ–æ˜¯ç€è¦½å™¨é—œé–‰è€Œä¸Ÿå¤±ã€‚é€™ç¯‡æ–‡ç« æœƒç´€éŒ„ localStorage çš„ä½¿ç”¨æ–¹å¼å’Œæƒ…å¢ƒï¼Œä»¥åŠå’Œ Cookie çš„æ¯”è¼ƒã€‚

## ç›®éŒ„

- [ç›®éŒ„](#ç›®éŒ„)
- [Web Storage API](#web-storage-api)
  - [è½‰å‹å•é¡Œ](#è½‰å‹å•é¡Œ)
- [DevTools](#devtools)
- [Life Cycle](#life-cycle)
- [Session Storage](#session-storage)
- [æ•æ„Ÿè³‡è¨Š](#æ•æ„Ÿè³‡è¨Š)
- [ä½¿ç”¨æƒ…å¢ƒ](#ä½¿ç”¨æƒ…å¢ƒ)
- [React Hooks](#react-hooks)
- [LocalForage](#localforage)
- [Reference](#reference)

## Web Storage API

[window.localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) èƒ½å¤ è®“å¦³å­˜å–ç•¶å‰ Domain ä¸‹çš„ [Storage](https://developer.mozilla.org/en-US/docs/Web/API/Storage) ç‰©ä»¶ã€‚Storage æ˜¯ç”¨ Key Value çš„å½¢å¼å„²å­˜è³‡æ–™ï¼Œå¯ä»¥ç›´æ¥ç”¨ç‰©ä»¶çš„æ–¹å¼æ“ä½œ:

```js
localStorage.theme = dark
console.log(localStorage.theme) // dark
```

ä½†ç”¨ä»¥ä¸Šæ–¹æ³•æ“ä½œæœƒæœ‰[æ½›åœ¨çš„é™·é˜±](https://2ality.com/2012/01/objects-as-maps.html)ï¼Œæ‰€ä»¥å»ºè­°å‘¼å«ä»¥ä¸‹å››éš» API é€²è¡Œæ“ä½œ:

- è¨­å®šè³‡æ–™: **[localStorage.setItem(key, value)](https://developer.mozilla.org/en-US/docs/Web/API/Storage/setItem)**
- ç²å–è³‡æ–™: **let storageValue = [localStorage.getItem(key)](https://developer.mozilla.org/en-US/docs/Web/API/Storage/getItem)**
- æ¸…é™¤è³‡æ–™: **[localStorage.removeItem(key)](https://developer.mozilla.org/en-US/docs/Web/API/Storage/removeItem)**
- æ¸…é™¤æ‰€æœ‰è³‡æ–™: **[localStorage.clear()](https://developer.mozilla.org/en-US/docs/Web/API/Storage/clear)**

### è½‰å‹å•é¡Œ

Storage ä¸­çš„ key value ç‚º string å‹æ…‹ï¼Œæ‰€ä»¥å¦‚æœçµ¦äºˆé string çš„ key value æœƒè‡ªå‹•è½‰å‹ã€‚

```js
localStorage.setItem('count', 41)
localStorage.getItem('count') // "41"

localStorage.setItem(666, 'devil')
localStorage.getItem('666') // "devil"

// Why???? ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”
localStorage.setItem('person', { name: 'Galtz', age: 23 })
localStorage.getItem('person') // [object Object]
```

ä¸Šé¢ç¯„ä¾‹ä¸­ï¼Œå„²å­˜ç‰©ä»¶æ™‚é‡åˆ°å­—ä¸²è½‰å‹å•é¡Œï¼ŒåŸå› åƒè€ƒä»¥ä¸‹å…©ç¯‡æ–‡ç« :

- https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString
- https://medium.com/better-programming/what-is-object-object-in-javascript-object-prototype-tostring-1db888c695a4

è§£æ±ºæ–¹æ³•ï¼š ä½¿ç”¨ [JSON Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON) é€²è¡Œè½‰æ›

```js
localStorage.setItem(
  'person',
  JSON.stringify({
    name: 'Galtz',
    age: 23,
  })
)

JSON.parse(localStorage.getItem('person')) // {name: "Galtz", age: 23}
```

## DevTools

åœ¨ **Application** -> **Storage** -> **Local Storage** ä¸‹ï¼Œè©³ç´°ä½¿ç”¨æ–¹å¼åƒè€ƒ [Chrome Local Storage Devtools](https://developers.google.com/web/tools/chrome-devtools/storage/localstorage)ã€‚

![Devtool](../images/localstorage/devtool.png)

## Life Cycle

ä¸æœƒéš¨è‘—é é¢é‡æ•´æˆ–æ˜¯ç€è¦½å™¨é—œé–‰è€Œä¸Ÿå¤±ã€‚é™¤éå‘¼å« `localStorage.removeItem` æˆ–æ˜¯ `localStorage.clear`ï¼Œå¦å‰‡æ°¸é å­˜åœ¨ã€‚

## Session Storage

Session Storage å’Œ Local Storage é™¤äº†ç”Ÿå‘½é€±æœŸä¸åŒä»¥å¤–å¹¾ä¹ä¸€æ¨¡ä¸€æ¨£ã€‚Session Storage çš„ç”Ÿå‘½å‘¨æœŸåªå­˜åœ¨ç€è¦½å›‚çš„å–®ä¸€åˆ†é ä¸­ ï¼Œä¹Ÿå°±æ˜¯å¦é–‹æ–°åˆ†é çš„è©± ï¼Œåˆæ˜¯ä¸€å€‹æ–°çš„ sessionStorage ï¼Œé è¨­ç„¡é€¾æœŸæ™‚é–“ï¼Œé™¤éé—œé–‰è©²åˆ†é ã€é—œé–‰ç€è¦½å™¨ç­‰ï¼ŒsessionStorage å°±æœƒæ¶ˆå¤±ã€‚

| ç‰¹æ€§            | Cookie            | LocalStorage         | SessionStorage         |
| --------------- | ----------------- | -------------------- | ---------------------- |
| ç”Ÿå‘½é€±æœŸ        | é è¨­ç‚º session    | é•·ç”Ÿä¸è€             | session                |
| å¤§å°é™åˆ¶        | 4K                | 5MB ä»¥ä¸Š             | 5MB ä»¥ä¸Š               |
| ç™¼é€è‡³ Server   | æ¯æ¬¡              | No                   | No                     |
| è¨­ç½®æ–¹æ³•        | Header Set-Cookie | localStorage.setItem | sessionStorage.setItem |
| Client è®€å–æ–¹æ³• | document.cookie   | localStorage.getItem | sessionStorage.getItem |

## æ•æ„Ÿè³‡è¨Š

å®‰å…¨æ€§çš„å•é¡Œæˆ‘é‚„ä¸å¤ªæš¸è§£ï¼Œå¯ä»¥å…ˆåƒè€ƒä»¥ä¸‹å¹¾å‰‡è¨è«–

- https://stackoverflow.com/questions/3718349/html5-localstorage-security
- https://stackoverflow.com/questions/17280390/can-local-storage-ever-be-considered-secure/24677597#24677597
- https://stackoverflow.com/questions/44133536/is-it-safe-to-store-a-jwt-in-localstorage-with-reactjs

## ä½¿ç”¨æƒ…å¢ƒ

TODO

## React Hooks

[react-use](https://github.com/streamich/react-use) æä¾›è¨±å¤šå¯¦ç”¨çš„ Hooksï¼Œå…¶ä¸­åŒ…æ‹¬ [useLocalStorage](https://github.com/streamich/react-use/blob/master/docs/useLocalStorage.md)ï¼Œä»¥ä¸‹ç¯„ä¾‹ï¼š

```js
import { useLocalStorage } from 'react-use'

const Demo = () => {
  const [value, setValue] = useLocalStorage('my-key', 'foo')

  return (
    <div>
      <div>Value: {value}</div>
      <button onClick={() => setValue('bar')}>bar</button>
      <button onClick={() => setValue('baz')}>baz</button>
    </div>
  )
}
```

## LocalForage

ç ´è¬æ˜Ÿçš„ Libraryï¼ŒAPI å¹¾ä¹å’Œ LocalStorage ä¸€æ¨¡ä¸€æ¨£ï¼š

```js
// Set a value with localStorage:
localStorage.setItem('key', JSON.stringify('value'))
doSomethingElse()

// The same code with localForage:
localforage.setItem('key', 'value').then(doSomethingElse)

// localForage also support callbacks:
localforage.setItem('key', 'value', doSomethingElse)
```

ç°¡å–®çš„ä¾†èªª [LocalForage](https://github.com/localForage/localForage) åšçš„æ˜¯ä»¥ä¸‹äº‹æƒ…:

1. å¦‚æœ Browser æ”¯æ´ [IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Using_IndexedDB)ï¼Œå°±å„ªå…ˆä½¿ç”¨ IndexedDB ä¾†å„²å­˜
2. å¦‚æœä¸æ”¯æ´ï¼Œå‰‡ä½¿ç”¨ WebSQL
3. å¦‚æœé€£ WebSQL éƒ½ä¸æ”¯æ´ï¼Œæ‰æœƒä½¿ç”¨ LocaloStorage ä¾†å„²å­˜è³‡æ–™ã€‚

LocalForage è§£æ±ºäº†ä»¥ä¸‹å¹¾å€‹å•é¡Œ:

1. å› ç‚ºä½¿ç”¨ IndexedDB ï¼Œæ•ˆèƒ½è¼ƒå¥½ã€å„²å­˜å¤§å°å¹¾ä¹æ²’æœ‰é™åˆ¶ï¼Œä¸”å¯ä»¥éåŒæ­¥æ“ä½œ
2. API å¹¾ä¹å’Œ LocalStorage ä¸€æ¨¡ä¸€æ¨£ï¼Œè§£æ±º IndexedDB ä¸å¥½ä¸Šæ‰‹çš„å›°æ“¾
3. è‡ªå‹•é€²è¡Œ `JSON.parse()` å’Œ `JSON.stringify()`

## Reference

- [Using the Web Storage API - MDN](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API)
- [[ç¬¬ä¸ƒé€±] ç€è¦½å™¨è³‡æ–™å„²å­˜ - Cookieã€LocalStorageã€SessionStorage](https://yakimhsu.com/project/project_w7_storage.html)
- [Cookieã€LocalStorageã€SessionStorage å·®ç•° - Peggy Chan - Medium](https://medium.com/@bebebobohaha/cookie-localstorage-sessionstorage-%E5%B7%AE%E7%95%B0-9e1d5df3dd7f)
- [localForage/localForage: ğŸ’¾ Offline storage, improved. Wraps IndexedDB, WebSQL, or localStorage using a simple but powerful API.](https://github.com/localForage/localForage)
