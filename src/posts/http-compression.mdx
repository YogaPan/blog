---
title: 'Http Compression 筆記'
date: '2020-01-10'
tags: 'http'
---

## 什麼是 Compression ？

[根據 Ilya Grigorik 的總整理](https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/optimize-encoding-and-transfer):

- Compression is the process of encoding information using fewer bits.
- GZIP performs best on text-based assets: CSS, JavaScript, HTML.
- All modern browsers support GZIP compression and will automatically request it.

## HTTP Header

[Content-Encoding](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Encoding) 表頭欄位，指出應用於表示的編碼方式，以指示 (訊息) 接收方，使用相應的解碼機制來獲取資料，主要用於壓縮資料，以增進傳輸效率。

參考 MDN: TODO

Request Header Example

```http
Accept-Encoding: gzip, deflate, br
```

Response Header Example

```http
Content-Encoding: gzip
```

其中 `br` 代表 [botli](https://github.com/google/brotli)， 是 google 推出的壓縮標準

上面有提到，現代的瀏覽器都會自動在 Request Header 要求 Server 使用壓縮：

![content-encoding](../images/http-compression/001.png)

## Expressd Middleware

透過 [compression middleware](https://github.com/expressjs/compression)，可以對 response 進行 `deflate` 或 `gzip` 壓縮。

Example

```js
const express = require('express')
const compression = require('compression')

const app = express()

app.use(compression())

app.get('/', (req, res) => {
  res.send('Hello World')
})
```

壓縮前：

TODO: Image Here...

壓縮後：

TODO: image here...

## 參考資料

- [Optimizing Encoding and Transfer Size of Text-Based Assets](https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/optimize-encoding-and-transfer)
- [HTTP 內容類型 (Content-Type) & 內容編碼 (Content-Encoding) - NotFalse 技術客](https://notfalse.net/40/http-representation?subscribe=success#blog_subscription-9)

- https://ihower.tw/blog/archives/8489
