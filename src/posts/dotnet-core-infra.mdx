---
title: 'Dotnet Core å°ˆæ¡ˆå»ºç½®'
date: '2020-07-20'
tags: 'C#, Dotnet Core'
---

ç”±æ–¼æœ€è¿‘é€æ¼¸è½‰å‘é–‹ç™¼ C# çš„ API ç¨‹å¼ï¼Œèº«ç‚ºä¸€åå‰ç«¯å·¥ç¨‹å¸«ä¸€è·¯ä¸Šç•¶ç„¶ç¢°å£é€£é€£ã€‚
é€™ç¯‡æ–‡ç« æœƒç°¡å–®ç´€éŒ„ä¸€ä¸‹å¦‚ä½•æ–°å»ºä¸€å€‹ .NET çš„ Web Applicationï¼ŒåŒæ™‚åŒ…å« gRPC å’Œ Test çš„è¨­ç½®ã€‚

æ–‡ç« ä¸­ç›¡é‡æœƒæ‹¿ Javascript çš„å°ˆæ¡ˆå»ºç½®å’ŒæŒ‡ä»¤ä¾†å’Œ .NET å°æ¯”ï¼Œå¸Œæœ›èƒ½è®“å‰ç«¯å·¥ç¨‹å¸«æ›´å¿«å¸æ”¶ã€‚

## Table of Contents

```toc

```

## Solution å’Œ Project ä¹‹é–“çš„é—œä¿‚

### Project

When you create an app or website in Visual Studio, you start with a project. In a logical sense, a project contains all files that are compiled into an executable, library, or website.

### Solution

Itâ€™s simply a container for one or more related projects, along with build information, Visual Studio window settings, and any miscellaneous files that arenâ€™t associated with a particular project.

èˆ‰ä¾‹èªªï¼š

**Solution**: CompanyName.ProjectName.sln åº•ä¸‹æœƒåŒ…å«

**Projects**:

- `CompanyName.ProjectName.Web`: çœŸæ­£æ‹¿ä¾†åŸ·è¡Œçš„æœ¬é«”
- `CompanyName.ProjectName.Test`:åŸ·è¡Œæ¸¬è©¦
- `CompanyName.Message`: æ ¹æ“š protos gRPC ç”¢å‡º

ğŸ“– å¸¸ç”¨ CLI æŒ‡ä»¤

```shell
dotnet new sln  # æ–°å¢ Solution
dotnet sln list  # é¡¯ç¤º sln åº•ä¸‹æ‰€æœ‰ project

dotnet new <template> [-n|--name <name>] # æ–° Project
dotnet sln add <project_path>
dotnet sln remove <project_path>
```

ğŸ“– å¸¸è¦‹çš„ Project Template

- `console`: command line tools
- `classlib`: ä½œç‚º common library (Common)
- `react`: React SPA æ‡‰ç”¨ (Web)
- `nunit`: donet core æ¸¬è©¦æ¡†æ¶ (Test)

## ç®¡ç†å¥—ä»¶

ğŸ’¡ å‰ç«¯å¿«é€Ÿç†è§£æ³•

- `NuGet` => `npm`
- `NuGet.config` => `.npmrc`
- `NuGet config` è¨­å®š `packageSources`, é¡ä¼¼ `npm config registry`

```xml
<configuration>
    <packageSources>
        <add key="Team Nuget" value="http://your.company.domain:8081/repository/nuget-group/" />
        <add key="nuget.org" value="https://api.nuget.org/v3/index.json" protocolVersion="3" />
    </packageSources>
</configuration>
```

å¥—ç”¨ä»¥ä¸Š NuGet Config è¨­å®šï¼Œå®‰è£ Nuget Package æ™‚æœƒå…ˆå¾å…¬å¸çš„ `Team Nuget` å˜—è©¦å®‰è£ï¼Œè‹¥å¤±æ•—å† Fallback å›åŸæœ¬å®˜æ–¹çš„ `nuget.org`

## å®‰è£å¥—ä»¶

```shell
dotnet add package <name>  # npm install <package> --save
dotnet remove package <name> # npm remove <package>
dotnet restore  # npm install
```

ğŸ¤« dotnet restore åœ¨ `dotnet new`, `dotnet run`, `dotnet build`, `dotnet test`, `dotnet publish`, `dotnet pack` æ™‚ä»–è‡ªå·±å°±æœƒå·å·åŸ·è¡Œï¼

## csproj æª”

ğŸ’¡ å‰ç«¯å¿«é€Ÿç†è§£æ³•
`csproj` => `package.json`

å¸¸è¦‹åˆ°çš„çš„æœ‰
`packageReference` å°±åƒæ˜¯ package.json è£¡çš„ `dependencies`
`projectReference` å‰‡æ˜¯æŒ‡å®šè¦åŒ…å«å“ªå€‹ projectï¼Œä¸¦ä¸”æœƒä¸€åŒè¢«ç·¨è­¯

```xml
<Project Sdk="Microsoft.NET.Sdk">
  <ItemGroup>
      <PackageReference Include="AsyncAwaitBestPractices" Version="4.1.1" />
      <PackageReference Include="AutoMapper" Version="9.0.0" />
      <PackageReference Include="IdGen" Version="2.4.0" />
  </ItemGroup>
  <ItemGroup>
      <ProjectReference Include="..\Componny.Message\Compony.Message.csproj" />
  </ItemGroup>
</Project>
```

ğŸ“– Reference æŒ‡ä»¤

```shell
dotnet add reference
dotnet remove reference
dotnet list reference
```

## é–‹å§‹åŸ·è¡Œå°ˆæ¡ˆ

### dotnet build

åŸ·è¡Œ `dotnet build` æœƒå°‡å·²ä¸‹æª”æ¡ˆæ‰“åŒ…è‡³ `{ProjectName}/bin/Debug/{DotnetCoreVersion}/publish`

1. å¯åŸ·è¡Œå’Œ çš„ `.dll`
2. ç›¸ä¾å‡½å¼åº«çš„ `.dll`

### dotnet run

é€šå¸¸æ˜¯ç‚ºäº†é–‹ç™¼ä½¿ç”¨ï¼Œå¯ä»¥åœ¨ Project åº•ä¸‹ç›´æ¥åŸ·è¡Œ `dotnet run` å³å¯ã€‚
`dotnet run` æœƒåŸ·è¡Œ `dotnet build` å»ç·¨è­¯ç¨‹å¼ç¢¼ã€‚

dotnet publish

åŸ·è¡Œ dotnet publish æœƒæŠŠä»¥ä¸‹æª”æ¡ˆæ‰“åŒ…è‡³ `{ProjectName}/bin/Debug/{DotnetCoreVersion}/publish` åº•ä¸‹

1. å¯åŸ·è¡Œå’Œ çš„ `.dll`
2. ç›¸ä¾å‡½å¼åº«çš„ `.dll`
3. å¦‚æœç•¶åˆå°ˆæ¡ˆæ˜¯ ClientApp ä¸­ç¶“é npm çš„ js ç•¶æ¡ˆ

### dotnet

```shell
$ cd '${ProjectName}/bin/Debug/${DotnetCoreVersion}/publish/${CompanyName.ProjectName.Web.dll}' && \
    dotnet ${CompanyName.ProjectName.Web.dll}
```

1. `dotnet` å’Œ `dotnet run` å·®åˆ¥åœ¨æ–¼ `dotnet` æœƒåŸ·è¡Œç¶“é `dotnet publish` çš„ .dllï¼Œé€šå¸¸æ˜¯åœ¨ Production ä¸Šä½¿ç”¨ã€‚
2. `dotnet` æŒ‡ä»¤ä¸åƒ `dotnet run` æœƒè‡ªå‹•å¹«ä½ åŸ·è¡Œ `dotnet build`ï¼Œä¸¦ä¸æœƒè‡ªå‹•å¹«ä½ åŸ·è¡Œ `dotnet publish`ã€‚

### dotnet test

è‡ªå‹•å¹«ä½ åŸ·è¡Œ Solution æˆ–æ˜¯ Project åº•ä¸‹çš„å–®å…ƒæ¸¬è©¦

ğŸ“– å¸¸è¦‹æŒ‡ä»¤

```shell
dotnet
dotnet run
dotnet build
dotnet test
dotnet publish
dotnet pack  # npm publish
```

## Reference

1. https://docs.microsoft.com/zh-tw/dotnet/core/tools/
